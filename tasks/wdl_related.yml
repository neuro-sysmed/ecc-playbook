
- name: install cromwell-utils
  pip:
    name: git+https://www.github.com/neuromics/cromwell-utils.git
    extra_args: --upgrade --prefix=/cluster/

- name: make dir for nsm-analysis
  file:
    path: "{{ nsm_analysis_root }}"
    owner: "{{nsm_analysis_user}}"
    state: directory

- name: Git checkout of nsm-analysis
  git:
    repo: https://github.com/neuromics/nsm-analysis.git
    dest: "{{ nsm_analysis_root }}"
    version: azure

- name: make imports paths absolute
  command: 
    chdir: "{{  nsm_analysis_root }}"
    cmd: /cluster/bin/cromwell-cli utils set-paths {{ nsm_analysis_root}}

- name: ensure jar dir exists
  file:
    path: /cluster/jars/
    state: directory
    
- name: download cromwell-jar
  get_url: 
    url: https://github.com/broadinstitute/cromwell/releases/download/60/cromwell-60.jar
    dest: /cluster/jars/
    mode: '0440'

- name: download womtool-jar
  get_url: 
    url: https://github.com/broadinstitute/cromwell/releases/download/60/womtool-60.jar
    dest: /cluster/jars/
    mode: '0440'

- name: Create a symbolic link to cromwell wrapper
  ansible.builtin.file:
    src: "{{  nsm_analysis_root }}/bin/cromwell"
    dest: /cluster/bin/cromwell
    state: link

- name: Create a symbolic link to womtool wrapper
  ansible.builtin.file:
    src: "{{  nsm_analysis_root }}/bin/womtool"
    dest: /cluster/bin/womtool
    state: link
